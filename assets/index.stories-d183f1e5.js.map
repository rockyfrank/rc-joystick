{"version":3,"file":"index.stories-d183f1e5.js","sources":["../../src/components/ghostArea/index.tsx"],"sourcesContent":["import './index.less';\n\nimport classNames from 'classnames';\nimport React, { MouseEventHandler, PropsWithChildren, TouchEventHandler } from 'react';\n\nimport { GhostAreaInstanceContext, GhostContext } from '../../context';\nimport { IGhostContextValue, ILocation } from '../../typings';\nimport { isMobile } from '../../utils/env';\n\nexport interface IGhostAreaProps extends Pick<React.CSSProperties, 'width' | 'height'> {\n  className?: string;\n}\n\nexport const GhostArea: React.FC<PropsWithChildren<IGhostAreaProps>> = ({\n  children,\n  className,\n  width,\n  height,\n}) => {\n  const area = React.useRef<HTMLDivElement>(null);\n  const [activeLocation, setActiveLocation] = React.useState<ILocation | null>(null);\n  const [isActive, setIsActive] = React.useState<boolean>(false);\n\n  const onDragStart = React.useCallback((clientX: number, clientY: number) => {\n    if (!area.current) return;\n    const { left, top, width: w, height: h } = area.current.getBoundingClientRect();\n    const nextLeft = clientX - left;\n    const nextTop = clientY - top;\n    const isValid = nextTop >= 0 && nextTop <= h && w >= 0 && nextLeft <= w;\n\n    if (!isValid) return;\n    setActiveLocation({\n      left: nextLeft,\n      top: nextTop,\n    });\n    setIsActive(true);\n  }, []);\n\n  const onMouseDown = React.useCallback<MouseEventHandler>(\n    (e) => {\n      if (isMobile()) return;\n      onDragStart(e.clientX, e.clientY);\n    },\n    [onDragStart],\n  );\n\n  const onTouchStart = React.useCallback<TouchEventHandler>(\n    ({ touches }) => {\n      if (!isMobile()) return;\n      const touch = touches[0];\n      onDragStart(touch.clientX, touch.clientY);\n    },\n    [onDragStart],\n  );\n\n  const ghostProviderValue = React.useMemo((): IGhostContextValue => {\n    return {\n      isActive,\n      ghost: true,\n    };\n  }, [isActive]);\n\n  const ghostAreaInstanceValue = React.useMemo(() => {\n    return {\n      getGhostArea: () => area.current,\n    };\n  }, []);\n\n  const onMouseUp = React.useCallback(() => {\n    setIsActive(false);\n  }, []);\n\n  React.useEffect(() => {\n    const eventName = isMobile() ? 'touchend' : 'mouseup';\n    document.addEventListener(eventName, onMouseUp);\n\n    return () => {\n      document.removeEventListener(eventName, onMouseUp);\n    };\n  }, [onMouseUp]);\n\n  const cls = React.useMemo(() => {\n    return classNames('react-joystick-ghost-area', className);\n  }, [className]);\n\n  const style = React.useMemo((): React.CSSProperties => {\n    return { height, width };\n  }, [height, width]);\n\n  return (\n    <div\n      ref={area}\n      className={cls}\n      onMouseDown={onMouseDown}\n      onTouchStart={onTouchStart}\n      style={style}\n    >\n      <div\n        className=\"react-joystick-wrapper\"\n        style={{ left: activeLocation?.left, top: activeLocation?.top }}\n      >\n        <GhostAreaInstanceContext.Provider value={ghostAreaInstanceValue}>\n          <GhostContext.Provider value={ghostProviderValue}>{children}</GhostContext.Provider>\n        </GhostAreaInstanceContext.Provider>\n      </div>\n    </div>\n  );\n};\n"],"names":["GhostArea","children","className","width","height","area","React","activeLocation","setActiveLocation","isActive","setIsActive","onDragStart","clientX","clientY","left","top","w","h","nextLeft","nextTop","onMouseDown","e","isMobile","onTouchStart","touches","touch","ghostProviderValue","ghostAreaInstanceValue","onMouseUp","eventName","cls","classNames","style","jsx","GhostAreaInstanceContext","GhostContext"],"mappings":"uLAaO,MAAAA,EAAA,CAAA,CAAiE,SAAAC,EACtE,UAAAC,EACA,MAAAC,EACA,OAAAC,CAEF,IAAA,CACE,MAAAC,EAAAC,EAAA,OAAA,IAAA,EACA,CAAAC,EAAAC,CAAA,EAAAF,EAAA,SAAA,IAAA,EACA,CAAAG,EAAAC,CAAA,EAAAJ,EAAA,SAAA,EAAA,EAEAK,EAAAL,EAAA,YAAA,CAAAM,EAAAC,IAAA,CACE,GAAA,CAAAR,EAAA,QAAmB,OACnB,KAAA,CAAA,KAAAS,EAAA,IAAAC,EAAA,MAAAC,EAAA,OAAAC,GAAAZ,EAAA,QAAA,sBAAA,EACAa,EAAAN,EAAAE,EACAK,EAAAN,EAAAE,EACAI,GAAA,GAAAA,GAAAF,GAAAD,GAAA,GAAAE,GAAAF,IAGAR,EAAA,CAAkB,KAAAU,EACV,IAAAC,CACD,CAAA,EAEPT,EAAA,EAAA,EAAgB,EAAA,CAAA,CAAA,EAGlBU,EAAAd,EAAA,YAA0Be,GAAA,CAEtBC,EAAA,GACAX,EAAAU,EAAA,QAAAA,EAAA,OAAA,CAAgC,EAClC,CAAAV,CAAA,CACY,EAGdY,EAAAjB,EAAA,YAA2B,CAAA,CAAA,QAAAkB,CAAA,IAAA,CAEvB,GAAA,CAAAF,EAAA,EAAiB,OACjB,MAAAG,EAAAD,EAAA,CAAA,EACAb,EAAAc,EAAA,QAAAA,EAAA,OAAA,CAAwC,EAC1C,CAAAd,CAAA,CACY,EAGde,EAAApB,EAAA,QAAA,KACE,CAAO,SAAAG,EACL,MAAA,EACO,GACT,CAAAA,CAAA,CAAA,EAGFkB,EAAArB,EAAA,QAAA,KACE,CAAO,aAAA,IAAAD,EAAA,OACoB,GAC3B,CAAA,CAAA,EAGFuB,EAAAtB,EAAA,YAAA,IAAA,CACEI,EAAA,EAAA,CAAiB,EAAA,CAAA,CAAA,EAGnBJ,EAAA,UAAA,IAAA,CACE,MAAAuB,EAAAP,IAAA,WAAA,UACA,gBAAA,iBAAAO,EAAAD,CAAA,EAEA,IAAA,CACE,SAAA,oBAAAC,EAAAD,CAAA,CAAiD,CACnD,EAAA,CAAAA,CAAA,CAAA,EAGF,MAAAE,EAAAxB,EAAA,QAAA,IACEyB,EAAA,4BAAA7B,CAAA,EAAwD,CAAAA,CAAA,CAAA,EAG1D8B,EAAA1B,EAAA,QAAA,KACE,CAAA,OAAAF,EAAA,MAAAD,IAAuB,CAAAC,EAAAD,CAAA,CAAA,EAGzB,OAAA8B,EACE,MAAC,CAAA,IAAA5B,EACM,UAAAyB,EACM,YAAAV,EACX,aAAAG,EACA,MAAAS,EACA,SAAAC,EAEA,MAAC,CAAA,UAAA,yBACW,MAAA,CAAA,KAAA1B,GAAA,YAAAA,EAAA,KAAA,IAAAA,GAAA,YAAAA,EAAA,GAAA,EACoD,SAAA0B,EAAAC,EAAA,SAAA,CAAA,MAAAP,EAAA,SAAAM,EAAAE,EAAA,SAAA,CAAA,MAAAT,EAAA,SAAAzB,CAAA,CAAA,EAAA,CAI9D,CAAA,CACF,CAAA,CAGN"}